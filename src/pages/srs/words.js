import { useEffect, useState } from 'react';import { supabase } from '../../lib/supabaseClient';import { Container, Card, Button } from '../../components/ui';import { nextReviewDate, updateBox } from '../../lib/srs';export default function Words(){const [session,setSession]=useState(null);const [due,setDue]=useState([]);const [idx,setIdx]=useState(0);const [answer,setAnswer]=useState('');useEffect(()=>{supabase.auth.getSession().then(({data})=>setSession(data.session||null))},[]);useEffect(()=>{if(!session)return;const load=async()=>{const today=new Date().toISOString().slice(0,10);const {data,error}=await supabase.from('srs_words').select('*').eq('user_id',session.user.id).lte('next_date',today).order('next_date',{ascending:true});if(error)alert(error.message);else setDue(data||[])};load()},[session]);const cur=due[idx];const record=async(correct)=>{const newBox=updateBox(correct,cur.box);const nextDate=nextReviewDate(newBox);const {error}=await supabase.from('srs_words').update({box:newBox,next_date:nextDate}).eq('id',cur.id);if(error)alert(error.message);setIdx(i=>Math.min(i+1,due.length-1));setAnswer('')};if(!session)return <Container><p>로그인 필요</p></Container>;if(!due.length)return <Container><p>오늘 복습할 단어가 없습니다.</p></Container>;return(<Container><h2>단어 SRS</h2><Card><h3>{cur.word}</h3><input value={answer} onChange={e=>setAnswer(e.target.value)} placeholder='뜻(한국어)' style={{width:'100%',padding:10}}/><div style={{marginTop:8}}><Button onClick={()=>alert('정답: '+cur.meaning_ko)}>정답 보기</Button></div><div style={{marginTop:8}}><Button onClick={()=>record(true)}>맞췄다</Button>{' '}<Button onClick={()=>record(false)}>틀렸다</Button></div></Card></Container>) }

